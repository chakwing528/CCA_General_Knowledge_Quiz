<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>常識問答比賽系統 PRO</title>
    <style>
        :root {
            --bg: #f4f7f6; --dark: #2c3e50; --primary: #3498db;
            --t1: #e74c3c; --t2: #2ecc71; --t3: #f1c40f; --t4: #9b59b6;
        }
        body { font-family: 'PingFang HK', 'Microsoft JhengHei', sans-serif; margin: 0; background: var(--bg); color: var(--dark); }
        
        /* Tab 控制 */
        .tabs { display: flex; background: var(--dark); }
        .tab-btn { flex: 1; padding: 15px; border: none; color: white; background: none; cursor: pointer; font-size: 18px; }
        .tab-btn.active { background: var(--primary); font-weight: bold; }
        .content-section { display: none; padding: 20px; }
        .content-section.active { display: block; }

        /* 管理模式樣式 */
        .admin-box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .q-list-item { background: #eee; padding: 10px; margin: 5px 0; border-radius: 4px; display: flex; justify-content: space-between; }
        .btn-add { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }

        /* 比賽模式樣式 */
        .game-layout { display: flex; flex-direction: column; height: 85vh; }
        .scoreboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .team-card { padding: 15px; color: white; border-radius: 10px; text-align: center; position: relative; }
        .team-card.active { outline: 8px solid #fff; box-shadow: 0 0 30px rgba(0,0,0,0.5); z-index: 10; transform: scale(1.05); }
        .score { font-size: 40px; font-weight: bold; margin: 5px 0; }
        
        .display-area { flex-grow: 1; background: white; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .q-text { font-size: 48px; font-weight: bold; margin-bottom: 30px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; max-width: 800px; }
        .opt-item { background: #f8f9fa; border: 2px solid #ddd; padding: 20px; font-size: 24px; border-radius: 10px; }
        .opt-item.correct { background: #d4edda; border-color: #28a745; }

        .status-bar { font-size: 24px; padding: 10px 30px; border-radius: 30px; background: #95a5a6; color: white; margin-bottom: 20px; }
        .status-bar.waiting { background: #2ecc71; animation: pulse 1s infinite; }

        .controls { position: fixed; bottom: 0; width: 100%; background: #333; padding: 15px; display: flex; justify-content: center; gap: 10px; }
        .ctrl-btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background: #eee; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="tabs">
    <button class="tab-btn active" onclick="showTab('admin')">題目管理 (Setup)</button>
    <button class="tab-btn" onclick="showTab('game')">比賽界面 (Play)</button>
</div>

<div id="admin" class="content-section active">
    <div class="admin-box">
        <h3>新增題目</h3>
        <select id="q-type" onchange="toggleOptions()">
            <option value="MC">多項選擇題 (MC)</option>
            <option value="Short">短答題</option>
        </select>
        <textarea id="q-input" placeholder="請輸入題目內容"></textarea>
        <div id="mc-options">
            <input type="text" id="opt-A" placeholder="選項 A">
            <input type="text" id="opt-B" placeholder="選項 B">
            <input type="text" id="opt-C" placeholder="選項 C">
            <input type="text" id="opt-D" placeholder="選項 D">
        </div>
        <input type="text" id="q-ans" placeholder="請輸入正確答案 (如果是MC，請填寫 A/B/C/D)">
        <button class="btn-add" onclick="addQuestion()">加入題目清單</button>
    </div>

    <div class="admin-box">
        <h3>題目清單</h3>
        <div id="q-list"></div>
        <hr>
        <button onclick="exportData()">匯出題目檔案</button>
        <input type="file" id="importFile" onchange="importData()" style="display:none">
        <button onclick="document.getElementById('importFile').click()">匯入題目檔案</button>
        <button onclick="clearAll()" style="background: #e74c3c; color:white; border:none; padding:5px; float:right">清空所有題目</button>
    </div>
</div>

<div id="game" class="content-section">
    <div class="scoreboard">
        <div class="team-card" id="t1" style="background: var(--t1);">第一隊 (1)<div class="score" id="s1">0</div>
            <button onclick="adj(1,10)">+10</button> <button onclick="adj(1,-10)">-10</button></div>
        <div class="team-card" id="t2" style="background: var(--t2);">第二隊 (2)<div class="score" id="s2">0</div>
            <button onclick="adj(2,10)">+10</button> <button onclick="adj(2,-10)">-10</button></div>
        <div class="team-card" id="t3" style="background: var(--t3);">第三隊 (3)<div class="score" id="s3">0</div>
            <button onclick="adj(3,10)">+10</button> <button onclick="adj(3,-10)">-10</button></div>
        <div class="team-card" id="t4" style="background: var(--t4);">第四隊 (4)<div class="score" id="s4">0</div>
            <button onclick="adj(4,10)">+10</button> <button onclick="adj(4,-10)">-10</button></div>
    </div>

    <div class="display-area">
        <div id="status" class="status-bar">準備中</div>
        <div id="display-q" class="q-text">請先在管理頁面加入題目</div>
        <div id="display-opts" class="options-grid"></div>
        <div id="display-ans" style="margin-top:20px; font-size:28px; color:var(--t2); display:none"></div>
    </div>

    <div class="controls">
        <button class="ctrl-btn" onclick="moveQ(-1)">上一題</button>
        <button class="ctrl-btn" onclick="moveQ(1)">下一題</button>
        <button class="ctrl-btn" id="buzzer-btn" onclick="toggleBuzzer()" style="background:#2ecc71; color:white">開啟搶答</button>
        <button class="ctrl-btn" onclick="resetBuzzer()">重置搶答 (Space)</button>
        <button class="ctrl-btn" onclick="showAns()">顯示答案</button>
    </div>
</div>

<script>
    let questions = JSON.parse(localStorage.getItem('quiz_qs')) || [];
    let curIdx = -1;
    let scores = [0, 0, 0, 0];
    let buzzerActive = false;
    let winner = null;

    // Tab 切換
    function showTab(tab) {
        document.querySelectorAll('.content-section, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tab === 'admin') renderAdminList();
    }

    // 題目管理
    function toggleOptions() {
        document.getElementById('mc-options').style.display = (document.getElementById('q-type').value === 'MC') ? 'block' : 'none';
    }

    function addQuestion() {
        const type = document.getElementById('q-type').value;
        const q = {
            type,
            text: document.getElementById('q-input').value,
            ans: document.getElementById('q-ans').value,
            opts: type === 'MC' ? [
                document.getElementById('opt-A').value,
                document.getElementById('opt-B').value,
                document.getElementById('opt-C').value,
                document.getElementById('opt-D').value
            ] : []
        };
        questions.push(q);
        save();
        renderAdminList();
        // 清空輸入
        document.getElementById('q-input').value = '';
        document.getElementById('q-ans').value = '';
    }

    function renderAdminList() {
        const list = document.getElementById('q-list');
        list.innerHTML = questions.map((q, i) => `
            <div class="q-list-item">
                <span>${i+1}. [${q.type}] ${q.text.substring(0,20)}...</span>
                <button onclick="delQ(${i})">刪除</button>
            </div>
        `).join('');
    }

    function delQ(i) { questions.splice(i, 1); save(); renderAdminList(); }
    function save() { localStorage.setItem('quiz_qs', JSON.stringify(questions)); }
    function clearAll() { if(confirm('確定清空？')) {questions = []; save(); renderAdminList();} }

    // 比賽邏輯
    function moveQ(dir) {
        if(questions.length === 0) return;
        curIdx = Math.max(0, Math.min(questions.length - 1, curIdx + dir));
        renderGame();
    }

    function renderGame() {
        const q = questions[curIdx];
        document.getElementById('display-q').innerText = `${curIdx + 1}. ${q.text}`;
        const optsDiv = document.getElementById('display-opts');
        optsDiv.innerHTML = '';
        if(q.type === 'MC') {
            const labels = ['A','B','C','D'];
            q.opts.forEach((o, i) => {
                optsDiv.innerHTML += `<div class="opt-item" id="opt-${labels[i]}">${labels[i]}. ${o}</div>`;
            });
        }
        document.getElementById('display-ans').style.display = 'none';
        resetBuzzer();
    }

    function showAns() {
        const q = questions[curIdx];
        document.getElementById('display-ans').innerText = "正確答案：" + q.ans;
        document.getElementById('display-ans').style.display = 'block';
        if(q.type === 'MC') {
            const correctOpt = document.getElementById(`opt-${q.ans.toUpperCase()}`);
            if(correctOpt) correctOpt.classList.add('correct');
        }
    }

    // 搶答功能
    function toggleBuzzer() {
        buzzerActive = !buzzerActive;
        const btn = document.getElementById('buzzer-btn');
        const status = document.getElementById('status');
        if(buzzerActive) {
            btn.innerText = "關閉搶答"; btn.style.background = "#e74c3c";
            status.innerText = "請搶答！"; status.className = "status-bar waiting";
        } else {
            btn.innerText = "開啟搶答"; btn.style.background = "#2ecc71";
            status.innerText = "搶答暫停"; status.className = "status-bar";
        }
    }

    function resetBuzzer() {
        winner = null;
        document.querySelectorAll('.team-card').forEach(c => c.classList.remove('active'));
        if(buzzerActive) {
            document.getElementById('status').innerText = "請搶答！";
            document.getElementById('status').className = "status-bar waiting";
        } else {
            document.getElementById('status').innerText = "等待中";
            document.getElementById('status').className = "status-bar";
        }
    }

    document.addEventListener('keydown', (e) => {
        if(e.code === 'Space') { resetBuzzer(); e.preventDefault(); return; }
        if(!buzzerActive || winner !== null) return;
        if(['1','2','3','4'].includes(e.key)) {
            winner = e.key;
            document.getElementById(`t${winner}`).classList.add('active');
            document.getElementById('status').innerText = `第 ${winner} 隊搶到！`;
            document.getElementById('status').className = "status-bar";
            // 這裡可以加音效
        }
    });

    function adj(t, v) {
        scores[t-1] += v;
        document.getElementById(`s${t}`).innerText = scores[t-1];
    }

    // 匯出/匯入
    function exportData() {
        const blob = new Blob([JSON.stringify(questions)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'quiz_questions.json';
        a.click();
    }

    function importData() {
        const file = document.getElementById('importFile').files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            questions = JSON.parse(e.target.result);
            save();
            renderAdminList();
            alert('匯入成功！');
        };
        reader.readAsText(file);
    }
</script>

</body>
</html>
